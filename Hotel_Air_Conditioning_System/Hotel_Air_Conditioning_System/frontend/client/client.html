<html>

<head>
    <meta charset="UTF-8" />
    <script src="../resource/handsontable/dist/handsontable.full.min.js"></script>
    <link href="../resource/handsontable/dist/handsontable.full.min.css" rel="stylesheet" media="screen">  
    <script src="../resource/handsontable/dist/languages/zh-CN.js"></script>
</head>

<body>
    <p>状态：<label id="statusLabel"></label>
    </p>
    <p>当前温度：<label id="curTmpLabel"></label>
    </p>
    <p>目标温度：<label id="trgTmpLabel"></label>
        <input id="trgTmpInput" />
        <button id="chgTmpButton" type="button" onclick="onTmpSubmit()">确定</button>
    </p>
    <p>风速：<label id="curSpdLabel"></label>
        <p>
            <label>高</label>
            <input type="radio" id="spdHRadio" name="spdRadio" value="H" onclick="onSpdChg(this.value)"> 
            <label>中</label>
            <input type="radio" id="spdMRadio" name="spdRadio" value="M" onclick="onSpdChg(this.value)">
            <label>低</label>
            <input type="radio" id="spdLRadio" name="spdRadio" value="L" onclick="onSpdChg(this.value)">
        </p>
    </p>
    <p>总消费：<label id="totalLable"></label></p>

    <button id="switchButton" type="button" onclick="onSwitch()">开启</button>
</body>
<script>
    const HOST = "../../";

    var statusLabel = document.getElementById("statusLabel");
    var curSpdLabel = document.getElementById("curSpdLabel");
    var curTmpLabel = document.getElementById("curTmpLabel");
    var spdHRadio=document.getElementById("spdHRadio");
    var spdMRadio=document.getElementById("spdMRadio");
    var spdLRadio=document.getElementById("spdLRadio");

    var trgTmpInput = document.getElementById("trgTmpInput");
    var chgTmpButton = document.getElementById("chgTmpButton");
    var totalLabel = document.getElementById("totalLabel");
    var switchButton = document.getElementById("switchButton");

    var refreshRequest = new XMLHttpRequest();
    refreshRequest.onreadystatechange = function () {
        if (refreshRequest.readyState == 4) {
            if (refreshRequest.status == 200) {
                var data = JSON.parse(refreshRequest.responseText);
                switch (data.state) {
                    case "R": statusLabel.textContent = "运行"; break;
                    case "W": statusLabel.textContent = "等待"; break;
                    case "F": statusLabel.textContent = "关机"; break;
                    case "H": statusLabel.textContent = "挂起"; break;
                }
                curTmpLabel.textContent = data.curTmp;
                switch (data.spd) {
                    case "L":curSpdLabel.textContent = "低";
                    case "M":curSpdLabel.textContent = "中";
                    case "H":curSpdLabel.textContent = "高";
                }
                totalLabel = data.total;
            }
            else {
                console.error("refresh status error:" + refreshRequest.status);
                alert("刷新失败");
            }
        }
    }
    refreshRequest.ontimeout = function () {
        alert("刷新响应超时，请联系管理员");
        console.error("刷新超时");
    }
    var refreshPara = new Object();
    refreshPara.actorType = "cos";
    refreshPara.requestType = "ref";
    refreshPara.roomID = "1001";
    var refreshStr = JSON.stringify(refreshPara)
    function refresh() {
        refreshRequest.open("POST", HOST, true);
        refreshRequest.timeout = 3000;
        refreshRequest.send(refreshStr);
    }
    var refreshInterval = setInterval("refresh()", 10000);

    var turnOnRequest = new XMLHttpRequest();
    turnOnRequest.onreadystatechange = function () {
        if (turnOnRequest.readyState == 4) {
            if (turnOnRequest.status == 200) {
                switchButton.textContent = "关闭";
            }
            else {
                console.error("turnOn status error:" + turnOnRequest.status);
                alert("开机请求失败");
            }
            switchButton.disabled = false;
        }
    }
    turnOnRequest.ontimeout = function () {
        alert("开机响应超时，请联系管理员");
        console.error("开机超时");
        switchButton.disabled = false;
    }
    var turnOnPara = new Object();
    turnOnPara.actorType = "cos";
    turnOnPara.requestType = "on";
    turnOnPara.roomID = "1001";
    var turnOnStr = JSON.stringify(turnOnPara);
    var turnOffRequest = new XMLHttpRequest();
    turnOffRequest.onreadystatechange = function () {
        if (turnOffRequest.readyState == 4) {
            if (turnOffRequest.status) {
                switchButton.textContent = "开启";
            }
            else {
                console.error("turnOff status error:" + turnOffRequest.status);
                alert("关机请求失败");
            }
            switchButton.disabled = false;
        }
    }
    turnOffRequest.ontimeout = function () {
        alert("关机响应超时，请联系管理员");
        console.error("关机超时");
        switchButton.disabled = false;
    }
    var turnOffPara = new Object();
    turnOffPara.actorType = "cos";
    turnOffPara.requestType = "off";
    turnOffPara.roomID = "1001";
    var turnOffStr = JSON.stringify(turnOffPara);
    function onSwitch() {
        if (switchButton.textContent == "开启") {
            switchButton.disabled = true;
            turnOnRequest.open("POST", HOST, true);
            turnOnRequest.timeout = 3000;
            turnOnRequest.send(turnOnStr);
        }
        else {
            switchButton.disabled = true;
            turnOffRequest.open("POST", HOST, true);
            turnOffRequest.timeout = 3000;
            turnOffRequest.send(turnOffStr);
        }
    }

    var chgTmpRequest = new XMLHttpRequest();
    chgTmpRequest.onreadystatechange = function () {
        if (chgTmpRequest.readyState == 4) {
            if (chgTmpRequest.status != 200) {
                console.error("chgTmp status error:" + chgTmpRequest.status);
                alert("调温失败");
            }
            trgTmpInput.disabled = false;
            chgTmpButton.disabled = false;
        }
    }
    chgTmpRequest.ontimeout = function () {
        alert("调温响应超时，请联系管理员");
        console.error("调温超时");
        trgTmpInput.disabled = false;
        chgTmpButton.disabled = false;
    }
    var chgTmpPara = new Object();
    chgTmpPara.actorType = "cos";
    chgTmpPara.requestType = "tmp";
    chgTmpPara.roomID = "1001";
    function onTmpSubmit() {
        trgTmpInput.disabled = true;
        chgTmpButton.disabled = true;
        
        chgTmpPara.trg = parseFloat(trgTmpInput.value);
        chgTmpRequest.open("POST", HOST, true);
        chgTmpRequest.timeout = 3000;
        chgTmpRequest.send(JSON.stringify(chgTmpPara));
    }

    var chgSpdRequest = new XMLHttpRequest();
    chgSpdRequest.onreadystatechange = function () {
        if (chgSpdRequest.readyState == 4) {
            if (chgSpdRequest.status == 200) {
                curSpdLabel.textContent=chgSpdPara.trg;
            }
            else {
                console.error("chgSpd status error:" + chgSpdRequest.status);
                alert("调风速失败");
            }
            spdHRadio.disabled=false;
            spdMRadio.disabled=false;
            spdLRadio.disabled=false;
        }
    }
    chgSpdRequest.ontimeout = function () {
        alert("调风速响应超时，请联系管理员");
        console.error("调风速超时");
        spdHRadio.disabled=false;
        spdMRadio.disabled=false;
        spdLRadio.disabled=false;
    }
    var chgSpdPara = new Object();
    chgSpdPara.actorType = "cos";
    chgSpdPara.requestType = "spd";
    chgSpdPara.roomID = "1001";
    chgSpdPara.trg = "";
    function onSpdChg(value) {
        spdHRadio.disabled=true;
        spdMRadio.disabled=true;
        spdLRadio.disabled=true;
        chgSpdPara.trg =value;
        chgTmpRequest.open("POST", HOST, true);
        chgTmpRequest.timeout = 3000;
        chgTmpRequest.send(JSON.stringify(chgSpdPara));
    }    
</script>


</html>